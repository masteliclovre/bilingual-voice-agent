<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Preview UI</title>
    </head>
    <body>
        <h2>Vapi Bilingual Preview</h2>
        <label>System Prompt</label>
        <textarea id="prompt" rows="6" cols="70" placeholder="Enter your prompt here..."></textarea>
        <div>
            Voice (11labs voiceId): <input id="voice" value="21m00Tcm4TlvDq8ikWAM">
        </div>
        <button id="start">Start</button>
        <button id="stop">Stop</button>
        <pre id="log"></pre>

        <script type="module">
            import Vapi from 'https://cdn.jsdelivr.net/npm/@vapi-ai/web/+esm';
            const PUBLIC_KEY = 'YOUR_VAPI_PUBLIC_KEY';
            const ASSISTANT_ID = 'YOUR_ASSISTANT_ID';
            const vapi = new Vapi(PUBLIC_KEY);
            const logEl = document.getElementById('log');
            const log = (t) => logEl.textContent += t + '\n';
            let tFinal;

            document.getElementById('start').onclick = () => {
                const overrides = {
                    model: {messages: [{role: 'system', content: document.getElementById('prompt').value}]},
                    voice: {provider: 'elevenlabs', voiceId: document.getElementById('voice').value},
                    transcriber: { provider: 'custom-transcriber', server: { url: 'wss://YOUR_DOMAIN/router' }, secret: 'optional_vapi_secret' }
                };
                vapi.start(ASSISTANT_ID, overrides);
            };
            document.getElementById('stop').onclick = () => vapi.stop(ASSISTANT_ID);

            vapi.on('message', (m) => {
                if (m.type === 'transcript') {
                    if (m.transcriptType === 'final') tFinal = performance.now();
                    log(`${m.role}: ${m.transcript}`);
                }
                if (m.type === 'speech-update' && m.status === 'started' && tFinal) {
                    const ttfb = Math.round(performance.now() - tFinal);
                    log(`TTFB->speech: ${ttfb} ms`);
                    tFinal = undefined;
                    }
                });
                vapi.on('call-start', () => log('--- call started ---'));
                vapi.on('call-end', () => log('--- call ended ---'));
        </script>
    </body>
</html>